/*!
 * Aprico-gen
 * Deterministic password generator library based on scrypt algorithm. 
 * Copyright (c) 2018 Pino Ceniccola | GPLv3
 * https://aprico.org
 */
const aprico=(()=>{"use strict";const t="undefined"!=typeof module&&module.exports?require("scrypt-async"):window.scrypt;if("function"!=typeof t)throw new Error("Aprico requires scrypt-async-js library.");const e={N:Math.pow(2,14),r:8,p:1,dkLen:32,encoding:"hex"},s={N:Math.pow(2,5),r:8,p:1,dkLen:32,encoding:"hex"},r="abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",n="123456789",o="_!$-+";let l={length:20,letters:!0,numbers:!0,symbols:!0,variant:!1};const a=(t,e,s)=>{const r=e.length,n=s.length;let o=0;for(let s=0,n=t.length;s<n;s++)o=o*r+e.indexOf(t.charAt(s));if(o<0)return 0;let l=o%n,a=s.charAt(l),h=Math.floor(o/n);for(;h;)l=h%n,h=Math.floor(h/n),a=s.charAt(l)+a;return a},h=e=>{let h="";l.symbols&&(h+=o),l.numbers&&(h+=n),l.letters&&(h+=r);let i="",u=e.match(/(.{1,7})/g);for(let r=0,n=u.length-1;r<n;r++)l.length>9&&t(e,u[n-r-1],s,function(t){u=t.match(/(.{1,7})/g)}),i+=a(u[r],"0123456789abcdef",h);if(i.length<=l.length)return".";let c=(i.length-l.length)/2|0,p=(i=i.substring(c,c+l.length)).charAt(0);return l.letters&&l.length>6&&!/[a-zA-Z]/.test(p)&&(i=i.replace(p,a(p,o+n,r))),i},i=t=>("http"==(t=t.trim().toLowerCase()).substring(0,4)&&(t=t.substring(t.indexOf("://")+3,t.length)),-1!==t.indexOf(".")&&-1!==t.indexOf("/")&&(t=(t=t.split("/"))[0]),t);return{getPassword:(r,n,o,a)=>{a&&(t=>{for(let e in l)t.hasOwnProperty(e)&&(l[e]=t[e]);if(l.letters=!!l.letters,l.numbers=!!l.numbers,l.symbols=!!l.symbols,!l.letters&&!l.symbols&&!l.numbers)throw new Error("At least one character set (letters, numbers, symbols) must be chosen.");if(l.length=+l.length,"number"!=typeof l.length||l.length<4||l.length>40)throw new Error("Password length must be a number between 4 and 40.")})(a);let u=r+"."+(n=i(n))+"."+l.length+ +l.letters+ +l.symbols+ +l.numbers;l.variant&&"string"==typeof l.variant&&(u+="."+l.variant);let c={};return t(u,o,e,function(e){c.hash=e,c.pass=h(e),c=(e=>{let r=!1;for(;!r;)r=!0,!l.letters||/[a-z]/.test(e.pass)&&/[A-Z]/.test(e.pass)&&!/([A-z])\1{2}/.test(e.pass)||(r=!1),r&&l.numbers&&(!/[\d]/.test(e.pass)||/([\d])\1{2}/.test(e.pass))&&(r=!1),r&&l.symbols&&(!/[!$\-+_]/.test(e.pass)||/([!$\-+_])\1{2}/.test(e.pass))&&(r=!1),r||t(e.hash,e.pass,s,function(t){e.hash=t,e.pass=h(t)});return e})(c)}),c},getHashId:s=>{let l="",h=Math.pow(s.length,(s.match(/[aeiou]/gi)||[0,0,0]).length)+"";return h=a(h,"0123456789.e+Infity",n+o+r)+"",t(s,h,e,function(t){l=t}),l},normalizeService:i,version:"1.0.0"}})();"undefined"!=typeof module&&module.exports?module.exports=aprico:window.aprico=aprico;