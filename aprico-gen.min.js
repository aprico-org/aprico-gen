/*!
 * aprico-gen
 * Deterministic password generator library based on scrypt algorithm.
 * Copyright (c) 2018 Pino Ceniccola | GPLv3
 * https://aprico.org
 */
const aprico=(()=>{"use strict";const e="undefined"!=typeof module&&module.exports?require("scrypt-async"):window.scrypt;if("function"!=typeof e)throw new Error("aprico requires scrypt-async-js library.");const t={N:Math.pow(2,14),r:8,p:1,dkLen:32,encoding:"hex"},s={N:Math.pow(2,5),r:8,p:1,dkLen:32,encoding:"hex"},r="abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",n="123456789",o="_!$-+";let l={length:20,letters:!0,numbers:!0,symbols:!0,variant:!1};const a=(e,t,s)=>{const r=t.length,n=s.length;let o=0;for(let s=0,n=e.length;s<n;s++)o=o*r+t.indexOf(e.charAt(s));if(o<0)return 0;let l=o%n,a=s.charAt(l),h=Math.floor(o/n);for(;h;)l=h%n,h=Math.floor(h/n),a=s.charAt(l)+a;return a},h=t=>{let h="";l.symbols&&(h+=o),l.numbers&&(h+=n),l.letters&&(h+=r);let i="",p=t.match(/(.{1,7})/g);for(let r=0,n=p.length-1;r<n;r++)l.length>9&&e(t,p[n-r-1],s,e=>p=e.match(/(.{1,7})/g)),i+=a(p[r],"0123456789abcdef",h);if(i.length<=l.length)return".";let u=(i.length-l.length)/2|0,g=(i=i.substring(u,u+l.length)).charAt(0);return l.letters&&l.length>6&&!/[a-zA-Z]/.test(g)&&(i=i.replace(g,a(g,o+n,r))),i},i=e=>("http"==(e=e.trim().toLowerCase()).substring(0,4)&&(e=e.substring(e.indexOf("://")+3,e.length)),-1!==e.indexOf(".")&&-1!==e.indexOf("/")&&(e=(e=e.split("/"))[0]),e);return{getPassword:(r,n,o,a)=>{a&&(e=>{for(let t in l)e.hasOwnProperty(t)&&(l[t]=e[t]);if(l.letters=!!l.letters,l.numbers=!!l.numbers,l.symbols=!!l.symbols,!l.letters&&!l.symbols&&!l.numbers)throw new Error("At least one character set (letters, numbers, symbols) must be chosen.");if(l.length=+l.length,"number"!=typeof l.length||l.length<4||l.length>40)throw new Error("Password length must be a number between 4 and 40.")})(a);let p=r+"."+(n=i(n))+"."+l.length+ +l.letters+ +l.symbols+ +l.numbers;l.variant&&"string"==typeof l.variant&&(p+="."+l.variant);let u={};return e(p,o,t,e=>u.hash=e),u.pass=h(u.hash),u=(t=>{let r=!1;for(;!r;)r=!0,!l.letters||/[a-z]/.test(t.pass)&&/[A-Z]/.test(t.pass)&&!/([A-z])\1{2}/.test(t.pass)||(r=!1),r&&l.numbers&&(!/[\d]/.test(t.pass)||/([\d])\1{2}/.test(t.pass))&&(r=!1),r&&l.symbols&&(!/[!$\-+_]/.test(t.pass)||/([!$\-+_])\1{2}/.test(t.pass))&&(r=!1),r||(e(t.hash,t.pass,s,e=>t.hash=e),t.pass=h(t.hash));return t})(u)},getHashId:s=>{let l="",h=Math.pow(s.length,(s.match(/[aeiou]/gi)||[0,0,0]).length)+"";return h=a(h,"0123456789.e+Infity",n+o+r)+"",e(s,h,t,e=>l=e),l},normalizeService:i,version:"1.1.1"}})();"undefined"!=typeof module&&module.exports?module.exports=aprico:window.aprico=aprico;